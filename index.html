<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Music</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      cursor: pointer;
    }
    .sort-arrow {
      margin-left: 5px;
    }
  </style>
</head>
<body>

<h2>Welcome to my music page! Listen to all the tracks I know and like.</h2>

<table id="musicTable">
  <thead>
    <tr>
      <th onclick="toggleSortAlpha()">
        Music name
        <span id="sortArrowAlpha" class="sort-arrow">⬆</span>
      </th>
      <th>Listen to it</th>
      <th onclick="toggleSortDuration()">
        Duration
        <span id="sortArrowDuration" class="sort-arrow">⬆</span>
      </th>
    </tr>
  </thead>
  <tbody id="musicTableBody">
    <!-- The music tracks will be inserted here by JavaScript -->
  </tbody>
</table>

<script>
  let ascendingAlpha = true; // Default to alphabetical sorting ascending
  let ascendingDuration = true; // Default to shortest to longest duration

  const repoUrl = "https://api.github.com/repos/ton-utilisateur/ton-depot/contents/Music"; // Remplace par l'URL de ton dépôt GitHub

  // Fonction pour récupérer la liste des fichiers MP3 du dossier "Music" sur GitHub
  async function fetchMusicFiles() {
    try {
      const response = await fetch(repoUrl);
      const data = await response.json();

      // Filtrer les fichiers MP3 dans le dossier Music
      const mp3Files = data.filter(file => file.name.endsWith('.mp3')).map(file => ({
        name: file.name,
        url: file.download_url, // Lien direct pour télécharger le fichier
      }));

      // Charger les durées des fichiers MP3
      // Pour simplifier, on suppose des durées fictives ou on peut les récupérer via une API tierce si nécessaire
      const musicFilesWithDuration = mp3Files.map(file => ({
        ...file,
        duration: 180 + Math.floor(Math.random() * 180), // Durée aléatoire pour l'exemple (en secondes)
      }));

      // Populer le tableau avec les fichiers récupérés
      populateTable(musicFilesWithDuration);
    } catch (error) {
      console.error("Error fetching music files from GitHub:", error);
    }
  }

  // Fonction pour remplir le tableau avec les fichiers
  function populateTable(files) {
    const tbody = document.getElementById("musicTableBody");
    tbody.innerHTML = ''; // Clear existing table content

    files.forEach(file => {
      const row = document.createElement('tr');
      const nameCell = document.createElement('td');
      nameCell.textContent = file.name;
      const audioCell = document.createElement('td');
      const audioElement = document.createElement('audio');
      audioElement.controls = true;
      audioElement.src = file.url;
      audioCell.appendChild(audioElement);
      const durationCell = document.createElement('td');
      durationCell.textContent = `${file.duration} s`; // Durée en secondes

      row.appendChild(nameCell);
      row.appendChild(audioCell);
      row.appendChild(durationCell);
      tbody.appendChild(row);
    });
  }

  // Fonction de tri par ordre alphabétique
  function toggleSortAlpha() {
    ascendingAlpha = !ascendingAlpha;
    const sortedFiles = [...musicFiles].sort((a, b) => {
      const nameA = a.name.toLowerCase();
      const nameB = b.name.toLowerCase();
      return ascendingAlpha ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
    });
    document.getElementById("sortArrowAlpha").textContent = ascendingAlpha ? "⬆" : "⬇";
    populateTable(sortedFiles);
  }

  // Fonction de tri par durée
  function toggleSortDuration() {
    ascendingDuration = !ascendingDuration;
    const sortedFiles = [...musicFiles].sort((a, b) => ascendingDuration ? a.duration - b.duration : b.duration - a.duration);
    document.getElementById("sortArrowDuration").textContent = ascendingDuration ? "⬆" : "⬇";
    populateTable(sortedFiles);
  }

  // Appeler la fonction pour charger les fichiers lors de l'ouverture de la page
  fetchMusicFiles();
</script>

</body>
</html>