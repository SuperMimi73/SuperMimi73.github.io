<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Music</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      cursor: pointer;
    }
    .sort-arrow {
      margin-left: 5px;
    }
    #search-container {
      margin-top: 10px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

<h2>Welcome to my music page! Here are all the musics I know and like.</h2>

<div id="search-container">
  <input type="text" id="searchInput" placeholder="Search for a music...">
  <span id="visibleCount"></span>
</div>

<table id="musicTable">
  <thead>
    <tr>
      <th onclick="toggleNameSort()">Music name <span id="nameArrow" class="sort-arrow">⬆</span></th>
      <th onclick="toggleDurationSort()">Listen to it <span id="durationArrow" class="sort-arrow">⬍</span></th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let musicData = [];
let filteredData = [];
let ascendingName = true;
let ascendingDuration = true;
let currentSort = "name"; // or "duration"

async function fetchMusicData() {
  const response = await fetch("https://SuperMimi73.github.io/Music/musicData.json");
  musicData = await response.json();
  filteredData = [...musicData];
  sortAndDisplay();
}

function sortAndDisplay() {
  if (currentSort === "name") {
    filteredData.sort((a, b) =>
      ascendingName
        ? a.name.localeCompare(b.name)
        : b.name.localeCompare(a.name)
    );
    document.getElementById("nameArrow").textContent = ascendingName ? "⬆" : "⬇";
  } else {
    filteredData.sort((a, b) =>
      ascendingDuration
        ? timeToSeconds(a.duration) - timeToSeconds(b.duration)
        : timeToSeconds(b.duration) - timeToSeconds(a.duration)
    );
    document.getElementById("durationArrow").textContent = ascendingDuration ? "⬆" : "⬇";
  }

  const tbody = document.querySelector("#musicTable tbody");
  tbody.innerHTML = "";
  for (const music of filteredData) {
    const tr = document.createElement("tr");
    const nameTd = document.createElement("td");
    nameTd.textContent = music.name;
    const audioTd = document.createElement("td");
    audioTd.innerHTML = `<audio controls src="${music.url}"></audio>`;
    tr.appendChild(nameTd);
    tr.appendChild(audioTd);
    tbody.appendChild(tr);
  }

  document.getElementById("visibleCount").textContent = `${filteredData.length} musics shown`;
}

function timeToSeconds(time) {
  const [minutes, seconds] = time.split(":").map(Number);
  return minutes * 60 + seconds;
}

function toggleNameSort() {
  ascendingName = !ascendingName;
  currentSort = "name";
  sortAndDisplay();
}

function toggleDurationSort() {
  ascendingDuration = !ascendingDuration;
  currentSort = "duration";
  sortAndDisplay();
}

document.getElementById("searchInput").addEventListener("input", function () {
  const query = this.value.toLowerCase();
  filteredData = musicData.filter(music => music.name.toLowerCase().includes(query));
  sortAndDisplay();
});

window.addEventListener("DOMContentLoaded", fetchMusicData);
</script>

</body>
</html>
