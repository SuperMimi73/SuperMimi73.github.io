<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Music</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      cursor: pointer;
    }
    .sort-arrow {
      margin-left: 5px;
    }
  </style>
</head>
<body>

<h2>Welcome to my music page! Here are all the musics I know and like.</h2>
<input type="text" id="searchBar" placeholder="Search..." oninput="filterMusic()">
<span id="musicCount">0 audios found</span>

<table id="musicTable">
  <thead>
    <tr>
      <th onclick="toggleSort('name')">
        Music name <span id="sortNameArrow" class="sort-arrow">⬆</span>
      </th>
      <th onclick="toggleSort('duration')">
        Listen to it <span id="sortDurationArrow" class="sort-arrow"></span>
      </th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>

<script>
let musicData = [];
let ascendingName = true;
let ascendingDuration = true;

async function fetchMusic() {
  try {
    const response = await fetch('music.json');
    musicData = await response.json();
    displayMusic();
  } catch (error) {
    console.error('Error fetching music data:', error);
  }
}

function displayMusic() {
  const tbody = document.querySelector("#musicTable tbody");
  tbody.innerHTML = "";

  const searchTerm = document.getElementById("searchBar").value.toLowerCase();
  const filteredMusic = musicData.filter(m => m.name.toLowerCase().includes(searchTerm));

  filteredMusic.forEach(music => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${music.name.replace(/\.mp3$/, '')}</td>
      <td><audio controls src="Music/${music.file}"></audio></td>
    `;
    tbody.appendChild(row);
  });

  document.getElementById("musicCount").textContent = `${filteredMusic.length} audio${filteredMusic.length === 1 ? '' : 's'} found`;
}

function toggleSort(type) {
  if (type === 'name') {
    ascendingName = !ascendingName;
    musicData.sort((a, b) => ascendingName ? a.name.localeCompare(b.name) : b.name.localeCompare(a.name));
    document.getElementById("sortNameArrow").textContent = ascendingName ? "⬆" : "⬇";
  } else if (type === 'duration') {
    ascendingDuration = !ascendingDuration;
    musicData.sort((a, b) => ascendingDuration ? a.duration - b.duration : b.duration - a.duration);
    document.getElementById("sortDurationArrow").textContent = ascendingDuration ? "⬆" : "⬇";
  }
  displayMusic();
}

function filterMusic() {
  displayMusic();
}

document.addEventListener("DOMContentLoaded", () => {
  fetchMusic();
});
</script>

</body>
</html>
